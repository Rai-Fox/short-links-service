# üîó Short Links Service

üöÄ –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ–µ API-—Å–µ—Ä–≤–∏—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ—Ä–æ—Ç–∫–∏–º–∏ —Å—Å—ã–ª–∫–∞–º–∏, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞ FastAPI.

## üîß –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Å—ã–ª–æ–∫
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ JWT
- –û—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∏ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å—Å—ã–ª–æ–∫
- Swagger-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `/api/openapi`
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è

## üí° –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- FastAPI
- Uvicorn
- PostgreSQL
- Redis
- AuthX (JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
- Docker & Docker Compose
- pytest (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- SQLAlchemy (ORM)
- Pydantic (–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)

---

## üìÇ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –ß–µ—Ä–µ–∑ Docker:
```bash
git clone https://github.com/Rai-Fox/short-links-service.git
cd short-links-service
docker-compose up --build -d
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ app/                # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ api/            # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, —Å–µ—Ä–≤–∏—Å—ã –∏ —Å—Ö–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ core/           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ db/             # –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ main.py         # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ tests/              # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ htmlcov/            # –û—Ç—á—ë—Ç—ã –ø–æ–∫—Ä—ã—Ç–∏—è
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ README.md
```

---

## üîå API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### `POST /v1/links/shorten`
–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏.

**JSON:**
```json
{
  "original_url": "https://example.com",
  "custom_alias": "example123",           // optional
  "expires_at": "2025-03-01 00:24:13Z"    // optional
}
```


### `GET /v1/links/search?original_link=...`
–ü–æ–∏—Å–∫ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏ –ø–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É URL.

### `GET /v1/links/expired`
–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫.


### `PUT /v1/links/{short}`
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ —Å—Å—ã–ª–∫–µ.

### `GET /v1/links/{short}`
–†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–µ (307).

### `GET /v1/links/{short}/stats`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤.

### `DELETE /v1/links/{short}`
–£–¥–∞–ª–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏.

---

## üìÑ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ .env –∏ docker-compose.yml

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------------|------------|--------|
| `APP_NAME` | –ù–∞–∑–≤–∞–Ω–∏–µ | `"Short Links Service"` |
| `FASTAPI_HOST` | –•–æ—Å—Ç API | `0.0.0.0` |
| `FASTAPI_PORT` | –ü–æ—Ä—Ç | `8000` |
| `DATABASE_HOST` | –•–æ—Å—Ç –ë–î | `db` |
| `DATABASE_PORT` | –ü–æ—Ä—Ç –ë–î | `5432` |
| `DATABASE_NAME` | –ò–º—è –ë–î | `links_db` |
| `DATABASE_USER` | –°–µ–∫—Ä–µ—Ç-—Ñ–∞–π–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | `/run/secrets/db_user` |
| `DATABASE_PASSWORD` | –°–µ–∫—Ä–µ—Ç-—Ñ–∞–π–ª –ø–∞—Ä–æ–ª—è | `/run/secrets/db_password` |
| `REDIS_HOST` | –•–æ—Å—Ç Redis | `redis` |
| `REDIS_PORT` | –ü–æ—Ä—Ç Redis | `6379` |
| `JWT_SECRET_KEY` | –ö–ª—é—á –ø–æ–¥–ø–∏—Å–∏ | `/run/secrets/jwt_secret_key` |
| `JWT_ALGORITHM` | –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–ø–∏—Å–∏ | `HS256` |
| `JWT_ACCESS_TOKEN_EXPIRE_MINUTES` | TTL —Ç–æ–∫–µ–Ω–∞ | `5` |
| `LINKS_SERVICE_UNUSED_LINKS_THRESHOLD` | –ü–æ—Ä–æ–≥ "–∑–∞–±—Ä–æ—à–µ–Ω–Ω–æ—Å—Ç–∏" | `120` |

–ò –¥—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ `docker-compose.yml` –∏–ª–∏ `.env` —Ñ–∞–π–ª–µ.
---

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –∫–µ—à

### PostgreSQL
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å—Å—ã–ª–æ–∫, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.
- –¢–∞–±–ª–∏—Ü–∞ `links` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫.
- –¢–∞–±–ª–∏—Ü–∞ `users` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### Redis
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è TTL.

---

## üîí –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
JWT —á–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫—É `authx`. –î–ª—è –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫:
```
Authorization: Bearer <token>
```

---

## ü™• –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –£–¥–∞–ª—è–µ—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ (`expires_at < now()`)
- –£–¥–∞–ª—è–µ—Ç –∑–∞–±—Ä–æ—à–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ (–±–µ–∑ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∑–∞ `LINKS_SERVICE_UNUSED_LINKS_THRESHOLD` —Å–µ–∫—É–Ω–¥)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
pytest
pytest --cov=app --cov-report=html
open htmlcov/index.html
```

---

## üìÖ –õ–∏—Ü–µ–Ω–∑–∏—è
MIT License

---

¬© –°–µ—Ä–≥–µ–π –ë–æ—Ä–æ–¥–∞—á–µ–≤, 2025

